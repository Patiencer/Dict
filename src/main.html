<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>EngDict</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">
    <link rel="stylesheet" href="main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mousetrap/1.6.1/mousetrap.min.js"></script>
    <script>
        const { Main } = require('../dist/main.js');
        let main = new Main();
        Mousetrap.bind('ctrl+h', function () {
            document.getElementById('btnHistory').click();
        });
        Mousetrap.bind('ctrl+s', function () {
           let word= document.getElementById('word');
           word.focus();
           word.value='';
        });
        Mousetrap.bind('j', function () {
           let word=document.getElementById('word');
        })
        Mousetrap.bind('right',function () {
            
        })

    </script>
</head>

<body>

    <div class="container">
        <div class="row">
            <div class="col">
                <!-- Modal -->
                <div class="modal fade" id="historyModal" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-body">
                                <button class="btn btn-danger" onclick="deleteHistory()">DeleteAll</button>
                                <button class="btn btn-info">ExportAll</button>
                                <hr>
                                <div id="words">
                                    <div class="alert alert-primary" role="alert">
                                        bike:自行車
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="alert alert-danger" role="alert">
                                        dictionary:字典
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="input-group sticky-top" style="margin-top:10px;">
                    <input type="text" class="form-control" id="word" onkeypress="checkSearch(this,event)" placeholder="English">
                    <button class="input-group-addon" onclick="main.SearchClick()">Search</button>
                </div>
                <div id='google-result' class="alert alert-primary" style="margin-top:20px;">

                </div>
                <div id='result'>

                </div>

            </div>
            <div class="w-150">
                <div class="btn-group-vertical sticky-top" style="margin-top:20px;">
                    <button type="button" id="btnHistory" class="btn btn-info" data-toggle="modal" onclick="updateHistory()" data-target="#historyModal">
                        History
                    </button>
                    <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#historyModal">
                        Setting
                    </button>
                    <button onclick="navigateTranslate()" type="button" class="btn btn-secondary" >
                        Translate
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
        window.jQuery = window.$ = require('jquery');
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>

    <script>

       function checkSearch(input,ev) { 
            if (ev.code=='Enter') {
                main.searchClick();
                input.blur();
            }
            // if (ev.code=='Esc') {
            //     input.blur();
            // }
        }
        function deleteHistory() {
            let ok = confirm('Are you sure to delete all?');
            if (ok) {
                main.deleteAllWords();
            }
        }
        function delteWord(word) {
            let ok = confirm('Are you sure?');
            if (ok) {
                main.deleteWord(word);
            }
        }
        function updateHistory() {
            let div = document.getElementById('words');
            // div.innerHTML
            div.innerHTML = '';
            let words = main.getWords().then(value => {

                if (value instanceof Array == false) return;
                value.forEach(element => {
                    if (element.word) {
                        let template = "<div class='alert alert-primary' role='alert'>" + element.word + ":" + element.trans + "<button type='button' onclick='deleteWord(" + element.word + ")' class='close' data-dismiss='alert' aria-label='Close'> <span aria-hidden='true'>&times;</span> </button> </div>";

                        var wordnode = createelementfromhtml(template);
                        div.appendChild(wordnode[0]);
                    }
                });
            });
        }
        updateHistory();
        function createelementfromhtml(html) {
            let temp = document.createElement('temp');
            temp.innerHTML = html;
            return temp.childNodes;
        }
        function navigateTranslate(){
           main.navigateTranslate(); 
        }
    </script>
</body>

</html>